!function(){function e(e){var o=e.listSelections(),n=(arguments.length-1)/4;if(o.length!=n)throw new Failure("expected "+n+" selections, found "+o.length);for(var t=0,a=1;n>t;t++,a+=4){var s=Pos(arguments[a],arguments[a+1]),c=Pos(arguments[a+2],arguments[a+3]);eqPos(o[t].anchor,s,"anchor of selection "+t),eqPos(o[t].head,c,"head of selection "+t)}}function o(e){var o=e.listSelections(),n=(arguments.length-1)/2;if(o.length!=n)throw new Failure("expected "+n+" selections, found "+o.length);for(var t=0,a=1;n>t;t++,a+=2){eqPos(o[t].anchor,o[t].head,"something selected for "+t);var s=Pos(arguments[a],arguments[a+1]);eqPos(o[t].head,s,"selection "+t)}}function n(e){for(var o=[],n=1;n<arguments.length;n++){var t=arguments[n];t.head?o.push(t):o.push({head:t,anchor:t})}e.setSelections(o,o.length-1)}namespace="multi_",testCM("getSelection",function(e){n(e,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(2,2),head:Pos(2,0)}),eq(e.getSelection(),"1234\n56\n90"),eq(e.getSelection(!1).join("|"),"1234|56|90"),eq(e.getSelections().join("|"),"1234\n56|90")},{value:"1234\n5678\n90"}),testCM("setSelection",function(t){n(t,Pos(3,0),Pos(0,0),{anchor:Pos(2,5),head:Pos(1,0)}),e(t,0,0,0,0,2,5,1,0,3,0,3,0),t.setSelection(Pos(1,2),Pos(1,1)),e(t,1,2,1,1),n(t,{anchor:Pos(1,1),head:Pos(2,4)},{anchor:Pos(0,0),head:Pos(1,3)},Pos(3,0),Pos(2,2)),e(t,0,0,2,4,3,0,3,0),t.setSelections([{anchor:Pos(0,1),head:Pos(0,2)},{anchor:Pos(1,1),head:Pos(1,2)},{anchor:Pos(2,1),head:Pos(2,2)}],1),eqPos(t.getCursor("head"),Pos(1,2)),eqPos(t.getCursor("anchor"),Pos(1,1)),eqPos(t.getCursor("from"),Pos(1,1)),eqPos(t.getCursor("to"),Pos(1,2)),t.setCursor(Pos(1,1)),o(t,1,1)},{value:"abcde\nabcde\nabcde\n"}),testCM("somethingSelected",function(e){n(e,Pos(0,1),{anchor:Pos(0,3),head:Pos(0,5)}),eq(e.somethingSelected(),!0),n(e,Pos(0,1),Pos(0,3),Pos(0,5)),eq(e.somethingSelected(),!1)},{value:"123456789"}),testCM("extendSelection",function(o){n(o,Pos(0,1),Pos(1,1),Pos(2,1)),o.setExtending(!0),o.extendSelections([Pos(0,2),Pos(1,0),Pos(2,3)]),e(o,0,1,0,2,1,1,1,0,2,1,2,3),o.extendSelection(Pos(2,4),Pos(2,0)),e(o,2,4,2,0)},{value:"1234\n1234\n1234"}),testCM("addSelection",function(o){n(o,Pos(0,1),Pos(1,1)),o.addSelection(Pos(0,0),Pos(0,4)),e(o,0,0,0,4,1,1,1,1),o.addSelection(Pos(2,2)),e(o,0,0,0,4,1,1,1,1,2,2,2,2)},{value:"1234\n1234\n1234"}),testCM("replaceSelection",function(o){var n=[{anchor:Pos(0,0),head:Pos(0,1)},{anchor:Pos(0,2),head:Pos(0,3)},{anchor:Pos(0,4),head:Pos(0,5)},{anchor:Pos(2,1),head:Pos(2,4)},{anchor:Pos(2,5),head:Pos(2,6)}],t="123456\n123456\n123456";o.setValue(t),o.setSelections(n),o.replaceSelection("ab","around"),eq(o.getValue(),"ab2ab4ab6\n123456\n1ab5ab"),e(o,0,0,0,2,0,3,0,5,0,6,0,8,2,1,2,3,2,4,2,6),o.setValue(t),o.setSelections(n),o.replaceSelection("","around"),eq(o.getValue(),"246\n123456\n15"),e(o,0,0,0,0,0,1,0,1,0,2,0,2,2,1,2,1,2,2,2,2),o.setValue(t),o.setSelections(n),o.replaceSelection("X\nY\nZ","around"),e(o,0,0,2,1,2,2,4,1,4,2,6,1,8,1,10,1,10,2,12,1),o.replaceSelection("a","around"),e(o,0,0,0,1,0,2,0,3,0,4,0,5,2,1,2,2,2,3,2,4),o.replaceSelection("xy","start"),e(o,0,0,0,0,0,3,0,3,0,6,0,6,2,1,2,1,2,4,2,4),o.replaceSelection("z\nf"),e(o,1,1,1,1,2,1,2,1,3,1,3,1,6,1,6,1,7,1,7,1),eq(o.getValue(),"z\nfxy2z\nfxy4z\nfxy6\n123456\n1z\nfxy5z\nfxy")}),testCM("indentSelection",function(e){n(e,Pos(0,1),Pos(1,1)),e.indentSelection(4),eq(e.getValue(),"    foo\n    bar\nbaz"),n(e,Pos(0,2),Pos(0,3),Pos(0,4)),e.indentSelection(-2),eq(e.getValue(),"  foo\n    bar\nbaz"),n(e,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(1,3),head:Pos(2,0)}),e.indentSelection(-2),eq(e.getValue(),"foo\n  bar\nbaz")},{value:"foo\nbar\nbaz"}),testCM("killLine",function(e){n(e,Pos(0,1),Pos(0,2),Pos(1,1)),e.execCommand("killLine"),eq(e.getValue(),"f\nb\nbaz"),e.execCommand("killLine"),eq(e.getValue(),"fbbaz"),e.setValue("foo\nbar\nbaz"),n(e,Pos(0,1),{anchor:Pos(0,2),head:Pos(2,1)}),e.execCommand("killLine"),eq(e.getValue(),"faz")},{value:"foo\nbar\nbaz"}),testCM("deleteLine",function(e){n(e,Pos(0,0),{head:Pos(0,1),anchor:Pos(2,0)},Pos(4,0)),e.execCommand("deleteLine"),eq(e.getValue(),"4\n6\n7"),n(e,Pos(2,1)),e.execCommand("deleteLine"),eq(e.getValue(),"4\n6\n")},{value:"1\n2\n3\n4\n5\n6\n7"}),testCM("deleteH",function(e){n(e,Pos(0,4),{anchor:Pos(1,4),head:Pos(1,5)}),e.execCommand("delWordAfter"),eq(e.getValue(),"foo bar baz\nabc ef ghi\n"),e.execCommand("delWordAfter"),eq(e.getValue(),"foo  baz\nabc  ghi\n"),e.execCommand("delCharBefore"),e.execCommand("delCharBefore"),eq(e.getValue(),"fo baz\nab ghi\n"),n(e,Pos(0,3),Pos(0,4),Pos(0,5)),e.execCommand("delWordAfter"),eq(e.getValue(),"fo \nab ghi\n")},{value:"foo bar baz\nabc def ghi\n"}),testCM("goLineStart",function(t){n(t,Pos(0,2),Pos(0,3),Pos(1,1)),t.execCommand("goLineStart"),o(t,0,0,1,0),n(t,Pos(1,1),Pos(0,1)),t.setExtending(!0),t.execCommand("goLineStart"),e(t,0,1,0,0,1,1,1,0)},{value:"foo\nbar\nbaz"}),testCM("moveV",function(t){n(t,Pos(0,2),Pos(1,2)),t.execCommand("goLineDown"),o(t,1,2,2,2),t.execCommand("goLineUp"),o(t,0,2,1,2),t.execCommand("goLineUp"),o(t,0,0,0,2),t.execCommand("goLineUp"),o(t,0,0),n(t,Pos(0,2),Pos(1,2)),t.setExtending(!0),t.execCommand("goLineDown"),e(t,0,2,2,2)},{value:"12345\n12345\n12345"}),testCM("moveH",function(e){n(e,Pos(0,1),Pos(0,3),Pos(0,5),Pos(2,3)),e.execCommand("goCharRight"),o(e,0,2,0,4,1,0,2,4),e.execCommand("goCharLeft"),o(e,0,1,0,3,0,5,2,3);for(var t=0;15>t;t++)e.execCommand("goCharRight");o(e,2,4,2,5)},{value:"12345\n12345\n12345"}),testCM("newlineAndIndent",function(e){n(e,Pos(0,5),Pos(1,5)),e.execCommand("newlineAndIndent"),o(e,1,2,3,2),eq(e.getValue(),"x = [\n  1];\ny = [\n  2];"),e.undo(),eq(e.getValue(),"x = [1];\ny = [2];"),o(e,0,5,1,5),n(e,Pos(0,5),Pos(0,6)),e.execCommand("newlineAndIndent"),o(e,1,2,2,0),eq(e.getValue(),"x = [\n  1\n];\ny = [2];")},{value:"x = [1];\ny = [2];",mode:"javascript"}),testCM("goDocStartEnd",function(t){n(t,Pos(0,1),Pos(1,1)),t.execCommand("goDocStart"),o(t,0,0),n(t,Pos(0,1),Pos(1,1)),t.execCommand("goDocEnd"),o(t,1,3),n(t,Pos(0,1),Pos(1,1)),t.setExtending(!0),t.execCommand("goDocEnd"),e(t,1,1,1,3)},{value:"abc\ndef"}),testCM("selectionHistory",function(e){for(var o=0;3>o;++o)e.addSelection(Pos(0,2*o),Pos(0,2*o+1));e.execCommand("undoSelection"),eq(e.getSelection(),"1\n2"),e.execCommand("undoSelection"),eq(e.getSelection(),"1"),e.execCommand("undoSelection"),eq(e.getSelection(),""),eqPos(e.getCursor(),Pos(0,0)),e.execCommand("redoSelection"),eq(e.getSelection(),"1"),e.execCommand("redoSelection"),eq(e.getSelection(),"1\n2"),e.execCommand("redoSelection"),eq(e.getSelection(),"1\n2\n3")},{value:"1 2 3"})}();